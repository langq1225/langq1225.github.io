<!doctype html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Langqing's Blog</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            fontFamily: { sans: ["Plus Jakarta Sans", "sans-serif"] },
            colors: {
              primary: {
                50: "#eff6ff",
                100: "#dbeafe",
                200: "#bfdbfe",
                400: "#60a5fa",
                500: "#3b82f6",
                600: "#2563eb",
                700: "#1d4ed8",
                800: "#1e40af",
                900: "#1e3a8a",
              },
            },
          },
        },
      };
    </script>
    <style>
      body {
        font-family: "Plus Jakarta Sans", sans-serif;
      }

      .calendar-day {
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        border-radius: 0.5rem;
        transition: all 0.25s ease;
        position: relative;
        margin: 0 auto;
        width: 100%;
        max-width: 2.5rem;
        cursor: pointer;
      }
      .calendar-day:hover {
        transform: scale(1.12);
      }
      .calendar-day.empty {
        cursor: default;
        opacity: 0;
        pointer-events: none;
      }

      .post-highlight {
        animation: highlight-pulse 1.5s ease-out;
      }
      @keyframes highlight-pulse {
        0% {
          box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.5);
        }
        50% {
          box-shadow: 0 0 0 8px rgba(59, 130, 246, 0.15);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
        }
      }

      /* Tag filter active state */
      .tag-btn.active {
        background: #2563eb !important;
        color: white !important;
        border-color: #2563eb !important;
      }
      .dark .tag-btn.active {
        background: #3b82f6 !important;
        border-color: #3b82f6 !important;
      }
    </style>
  </head>
  <body
    class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 min-h-screen"
  >
    <!-- Navbar -->
    <nav
      class="border-b border-slate-200 dark:border-slate-800 bg-white/70 dark:bg-slate-900/80 backdrop-blur sticky top-0 z-50 w-full"
    >
      <div
        class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center"
      >
        <a
          href="/"
          class="text-slate-500 dark:text-slate-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors flex items-center gap-2 font-medium"
        >
          <i class="fas fa-arrow-left"></i>
          <span>Back to Home</span>
        </a>
        <button
          id="theme-toggle"
          class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-all text-slate-600 dark:text-slate-400 active:scale-95"
          aria-label="Toggle Dark Mode"
        >
          <i class="fas fa-moon dark:hidden text-lg"></i>
          <i class="fas fa-sun hidden dark:block text-lg"></i>
        </button>
      </div>
    </nav>

    <main class="max-w-6xl mx-auto px-6 py-10">
      <!-- Header -->
      <header class="text-center w-full mb-10">
        <h1
          class="text-4xl md:text-5xl font-bold pb-2 bg-gradient-to-r from-primary-600 to-indigo-600 bg-clip-text text-transparent inline-block"
        >
          Langqing's Blog
        </h1>
      </header>

      <!-- Two-column layout -->
      <div class="flex flex-col-reverse lg:flex-row gap-8 items-start">
        <!-- ═══════════ Left: Tabbed Content Area ═══════════ -->
        <section class="flex-1 w-full min-w-0">
          <!-- Tab Switcher -->
          <div
            class="flex items-center gap-1 mb-6 bg-slate-100 dark:bg-slate-800 rounded-xl p-1"
          >
            <button
              id="tab-posts"
              onclick="switchTab('posts')"
              class="tab-btn flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all duration-200"
            >
              <i class="fas fa-pen-nib text-xs"></i>
              <span>All Posts</span>
            </button>
            <button
              id="tab-daily"
              onclick="switchTab('daily')"
              class="tab-btn flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all duration-200"
            >
              <i class="fas fa-robot text-xs"></i>
              <span>Daily Updates</span>
              <span
                class="text-[9px] font-medium text-emerald-600 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-900/30 px-1.5 py-0.5 rounded"
                >AI</span
              >
            </button>
          </div>

          <!-- Posts View -->
          <div id="view-posts">
            <!-- Tag Filter Bar -->
            <div id="tag-filter-bar" class="flex flex-wrap gap-2 mb-5"></div>
            <!-- Posts List -->
            <div id="posts-list" class="space-y-5"></div>
          </div>

          <!-- Daily Updates View (hidden by default) -->
          <div id="view-daily" class="hidden">
            <div id="daily-updates-list" class="space-y-4"></div>
          </div>
        </section>

        <!-- ═══════════ Right: Calendar Sidebar ═══════════ -->
        <aside class="w-full lg:w-80 lg:flex-shrink-0 lg:sticky lg:top-24">
          <div
            class="bg-white dark:bg-slate-800 rounded-2xl p-5 shadow-lg border border-slate-200/60 dark:border-slate-700/60 transition-colors duration-300"
          >
            <div class="flex items-center justify-between mb-5">
              <button
                id="prev-month"
                class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 text-slate-400 hover:text-slate-800 dark:hover:text-slate-100 transition-all active:scale-90 text-xs"
              >
                <i class="fas fa-chevron-left"></i>
              </button>
              <h2
                id="current-month"
                class="text-base font-bold text-slate-800 dark:text-white"
              ></h2>
              <button
                id="next-month"
                class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 text-slate-400 hover:text-slate-800 dark:hover:text-slate-100 transition-all active:scale-90 text-xs"
              >
                <i class="fas fa-chevron-right"></i>
              </button>
            </div>

            <div class="grid grid-cols-7 gap-1 mb-2">
              <div
                class="text-center text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase py-1"
              >
                S
              </div>
              <div
                class="text-center text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase py-1"
              >
                M
              </div>
              <div
                class="text-center text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase py-1"
              >
                T
              </div>
              <div
                class="text-center text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase py-1"
              >
                W
              </div>
              <div
                class="text-center text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase py-1"
              >
                T
              </div>
              <div
                class="text-center text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase py-1"
              >
                F
              </div>
              <div
                class="text-center text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase py-1"
              >
                S
              </div>
            </div>

            <div id="calendar-grid" class="grid grid-cols-7 gap-1"></div>

            <div
              class="mt-4 pt-4 border-t border-slate-100 dark:border-slate-700 flex items-center gap-4 text-[10px] text-slate-400 dark:text-slate-500"
            >
              <div class="flex items-center gap-1.5">
                <span
                  class="inline-block w-3 h-3 rounded bg-emerald-50 dark:bg-emerald-900/30 ring-1 ring-emerald-300 dark:ring-emerald-700"
                ></span>
                <span>Daily</span>
              </div>
              <div class="flex items-center gap-1.5">
                <span
                  class="inline-block w-3 h-3 rounded bg-blue-50 dark:bg-blue-900/30 ring-1 ring-blue-200 dark:ring-blue-800"
                ></span>
                <span>Post</span>
              </div>
              <div class="flex items-center gap-1.5">
                <span
                  class="inline-block w-3 h-3 rounded ring-2 ring-blue-500"
                ></span>
                <span>Today</span>
              </div>
            </div>
          </div>
        </aside>
      </div>
    </main>

    <script>
      // ── Theme Toggle ─────────────────────────
      const themeToggle = document.getElementById("theme-toggle");
      const html = document.documentElement;
      const savedTheme = localStorage.getItem("blog-theme") || "dark";
      if (savedTheme === "dark") html.classList.add("dark");

      themeToggle.addEventListener("click", () => {
        html.classList.toggle("dark");
        localStorage.setItem(
          "blog-theme",
          html.classList.contains("dark") ? "dark" : "light",
        );
      });

      // ══════════════════════════════════════════
      //  TAB SWITCHING
      // ══════════════════════════════════════════

      let activeTab = "posts";

      function switchTab(tab) {
        activeTab = tab;
        const postsView = document.getElementById("view-posts");
        const dailyView = document.getElementById("view-daily");
        const tabPosts = document.getElementById("tab-posts");
        const tabDaily = document.getElementById("tab-daily");

        const activeClasses = [
          "bg-white",
          "dark:bg-slate-700",
          "text-slate-900",
          "dark:text-white",
          "shadow-sm",
        ];
        const inactiveClasses = [
          "text-slate-500",
          "dark:text-slate-400",
          "hover:text-slate-700",
          "dark:hover:text-slate-300",
        ];

        if (tab === "posts") {
          postsView.classList.remove("hidden");
          dailyView.classList.add("hidden");
          activeClasses.forEach((c) => tabPosts.classList.add(c));
          inactiveClasses.forEach((c) => tabPosts.classList.remove(c));
          inactiveClasses.forEach((c) => tabDaily.classList.add(c));
          activeClasses.forEach((c) => tabDaily.classList.remove(c));
        } else {
          postsView.classList.add("hidden");
          dailyView.classList.remove("hidden");
          activeClasses.forEach((c) => tabDaily.classList.add(c));
          inactiveClasses.forEach((c) => tabDaily.classList.remove(c));
          inactiveClasses.forEach((c) => tabPosts.classList.add(c));
          activeClasses.forEach((c) => tabPosts.classList.remove(c));
        }
      }

      // ══════════════════════════════════════════
      //  DATA: loaded from external JSON files
      //  - posts.json   → your own written posts
      //  - daily.json   → AI daily updates
      //  Each entry has a "file" field (relative to /blog/content/)
      //  The URL is auto-generated as /blog/post.html?file=<file>
      // ══════════════════════════════════════════

      let posts = [];
      let dailyUpdates = [];

      async function loadData() {
        try {
          const [postsRes, dailyRes] = await Promise.all([
            fetch("/blog/posts.json"),
            fetch("/blog/daily.json"),
          ]);
          const postsData = await postsRes.json();
          const dailyData = await dailyRes.json();

          // Auto-generate url from file field
          posts = postsData.map((p) => ({
            ...p,
            url: `/blog/post.html?file=${p.file}`,
          }));
          dailyUpdates = dailyData.map((d) => ({
            ...d,
            url: `/blog/post.html?file=${d.file}`,
          }));
        } catch (err) {
          console.error("Failed to load blog data:", err);
        }
      }

      // ══════════════════════════════════════════
      //  TAG FILTERING
      // ══════════════════════════════════════════

      let activeTag = null; // null = show all

      function getAllTags() {
        const tagSet = new Set();
        posts.forEach((p) => p.tags.forEach((t) => tagSet.add(t)));
        return [...tagSet].sort();
      }

      function renderTagFilter() {
        const bar = document.getElementById("tag-filter-bar");
        const tags = getAllTags();
        if (tags.length === 0) {
          bar.innerHTML = "";
          return;
        }

        bar.innerHTML =
          `<button class="tag-btn text-[11px] px-3 py-1 rounded-full border border-slate-200 dark:border-slate-600 text-slate-500 dark:text-slate-400 font-medium transition-all hover:border-primary-400 ${activeTag === null ? "active" : ""}" data-tag="">All</button>` +
          tags
            .map(
              (t) =>
                `<button class="tag-btn text-[11px] px-3 py-1 rounded-full border border-slate-200 dark:border-slate-600 text-slate-500 dark:text-slate-400 font-medium transition-all hover:border-primary-400 ${activeTag === t ? "active" : ""}" data-tag="${t}">${t}</button>`,
            )
            .join("");

        bar.querySelectorAll(".tag-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            const tag = btn.dataset.tag;
            activeTag = tag === "" ? null : tag;
            renderTagFilter();
            renderPosts();
          });
        });
      }

      // ══════════════════════════════════════════
      //  CALENDAR (tracks both posts & dailyUpdates)
      // ══════════════════════════════════════════

      let currentDate = new Date();

      function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const monthNames = [
          "January",
          "February",
          "March",
          "April",
          "May",
          "June",
          "July",
          "August",
          "September",
          "October",
          "November",
          "December",
        ];
        document.getElementById("current-month").textContent =
          `${monthNames[month]} ${year}`;

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const today = new Date();
        const grid = document.getElementById("calendar-grid");
        grid.innerHTML = "";

        // Limit next month
        const nextBtn = document.getElementById("next-month");
        if (year === today.getFullYear() && month >= today.getMonth()) {
          nextBtn.classList.add("opacity-30", "cursor-not-allowed");
          nextBtn.disabled = true;
        } else {
          nextBtn.classList.remove("opacity-30", "cursor-not-allowed");
          nextBtn.disabled = false;
        }

        // Empty cells
        for (let i = 0; i < firstDay; i++) {
          const empty = document.createElement("div");
          empty.className = "calendar-day empty";
          grid.appendChild(empty);
        }

        // Days
        for (let day = 1; day <= daysInMonth; day++) {
          const dayEl = document.createElement("div");
          const dateStr = `${year}-${String(month + 1).padStart(2, "0")}-${String(day).padStart(2, "0")}`;
          const hasPost = posts.some((p) => p.date === dateStr);
          const hasDaily = dailyUpdates.some((d) => d.date === dateStr);
          const hasAny = hasPost || hasDaily;
          const isToday =
            day === today.getDate() &&
            month === today.getMonth() &&
            year === today.getFullYear();

          dayEl.className = "calendar-day";
          dayEl.textContent = day;

          if (hasPost && hasDaily) {
            // Both: blue + emerald split indicator
            dayEl.classList.add(
              "text-slate-900",
              "dark:text-white",
              "font-bold",
              "bg-gradient-to-br",
              "from-blue-50",
              "to-emerald-50",
              "dark:from-blue-900/30",
              "dark:to-emerald-900/30",
              "ring-1",
              "ring-blue-200",
              "dark:ring-blue-800",
              "shadow-sm",
            );
          } else if (hasPost) {
            dayEl.classList.add(
              "text-slate-900",
              "dark:text-white",
              "font-bold",
              "bg-blue-50",
              "dark:bg-blue-900/30",
              "ring-1",
              "ring-blue-200",
              "dark:ring-blue-800",
              "shadow-sm",
            );
          } else if (hasDaily) {
            dayEl.classList.add(
              "text-slate-900",
              "dark:text-white",
              "font-bold",
              "bg-emerald-50",
              "dark:bg-emerald-900/30",
              "ring-1",
              "ring-emerald-300",
              "dark:ring-emerald-700",
              "shadow-sm",
            );
          } else {
            dayEl.classList.add("text-slate-300", "dark:text-slate-600");
          }

          if (isToday) {
            dayEl.classList.add("ring-2", "ring-blue-500", "font-bold");
            if (!hasAny) {
              dayEl.classList.remove("text-slate-300", "dark:text-slate-600");
              dayEl.classList.add(
                "text-blue-600",
                "dark:text-blue-400",
                "bg-blue-50",
                "dark:bg-blue-900/20",
              );
            }
          }

          // Click → scroll to daily update or post
          dayEl.addEventListener("click", () => {
            if (hasDaily) {
              const el = document.getElementById(`daily-${dateStr}`);
              if (el) {
                el.scrollIntoView({ behavior: "smooth", block: "center" });
                el.classList.remove("post-highlight");
                void el.offsetWidth;
                el.classList.add("post-highlight");
              }
            } else if (hasPost) {
              const el = document.getElementById(`post-${dateStr}`);
              if (el) {
                el.scrollIntoView({ behavior: "smooth", block: "center" });
                el.classList.remove("post-highlight");
                void el.offsetWidth;
                el.classList.add("post-highlight");
              }
            }
          });

          grid.appendChild(dayEl);
        }
      }

      // ══════════════════════════════════════════
      //  RENDER POSTS (with tag filtering)
      // ══════════════════════════════════════════

      function renderPosts() {
        const container = document.getElementById("posts-list");
        let filtered = [...posts];
        if (activeTag) {
          filtered = filtered.filter((p) => p.tags.includes(activeTag));
        }

        if (filtered.length === 0) {
          const msg = activeTag
            ? `No posts with tag "${activeTag}".`
            : "No posts yet.";
          container.innerHTML = `<p class="text-slate-400 dark:text-slate-500 text-center py-10">${msg}</p>`;
          return;
        }

        filtered.sort((a, b) => new Date(b.date) - new Date(a.date));

        container.innerHTML = filtered
          .map(
            (p) => `
          <article id="post-${p.date}" class="bg-white dark:bg-slate-800/50 rounded-xl p-5 border border-slate-200 dark:border-slate-700 hover:border-primary-400 dark:hover:border-primary-500 transition-all duration-300 scroll-mt-24">
            <time class="text-xs font-medium text-slate-400 dark:text-slate-500">${new Date(p.date + "T00:00:00").toLocaleDateString("en-US", { year: "numeric", month: "long", day: "numeric" })}</time>
            <h2 class="text-lg font-semibold mt-1.5 mb-2 text-slate-900 dark:text-white">
              <a href="${p.url}" class="hover:text-primary-600 dark:hover:text-primary-400 transition-colors">${p.title}</a>
            </h2>
            <div class="flex flex-wrap gap-2">
              ${p.tags.map((t) => `<button class="tag-link text-[11px] bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded-full text-slate-500 dark:text-slate-400 font-medium hover:bg-primary-100 dark:hover:bg-primary-900/40 hover:text-primary-600 dark:hover:text-primary-400 transition-colors cursor-pointer" data-tag="${t}">${t}</button>`).join("")}
            </div>
          </article>
        `,
          )
          .join("");

        // Make inline tags clickable to filter
        container.querySelectorAll(".tag-link").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            e.preventDefault();
            activeTag = btn.dataset.tag;
            renderTagFilter();
            renderPosts();
            window.scrollTo({ top: 0, behavior: "smooth" });
          });
        });
      }

      // ══════════════════════════════════════════
      //  RENDER DAILY UPDATES
      // ══════════════════════════════════════════

      function renderDailyUpdates() {
        const container = document.getElementById("daily-updates-list");
        if (dailyUpdates.length === 0) {
          container.innerHTML =
            '<p class="text-slate-400 dark:text-slate-500 text-center py-10">No updates yet.</p>';
          return;
        }

        const sorted = [...dailyUpdates].sort(
          (a, b) => new Date(b.date) - new Date(a.date),
        );

        container.innerHTML = sorted
          .map(
            (d, i) => `
          <a id="daily-${i}" href="${d.url}" class="block bg-white dark:bg-slate-800/50 rounded-xl p-5 border border-slate-200 dark:border-slate-700 hover:border-emerald-400 dark:hover:border-emerald-500 transition-all duration-300 scroll-mt-24 group">
            <div class="flex items-center gap-2 mb-2">
              <span class="w-2 h-2 rounded-full bg-emerald-500 flex-shrink-0"></span>
              <time class="text-xs font-medium text-slate-400 dark:text-slate-500">${new Date(d.date + "T00:00:00").toLocaleDateString("en-US", { year: "numeric", month: "long", day: "numeric" })}</time>
            </div>
            <h2 class="text-lg font-semibold text-slate-900 dark:text-white mb-1.5 group-hover:text-emerald-600 dark:group-hover:text-emerald-400 transition-colors">${d.title}</h2>
            <p class="text-sm text-slate-500 dark:text-slate-400 leading-relaxed">${d.summary}</p>
          </a>
        `,
          )
          .join("");
      }

      // ══════════════════════════════════════════
      //  EVENT LISTENERS & INIT
      // ══════════════════════════════════════════

      document.getElementById("prev-month").addEventListener("click", () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar();
      });

      document.getElementById("next-month").addEventListener("click", () => {
        const today = new Date();
        if (
          currentDate.getFullYear() === today.getFullYear() &&
          currentDate.getMonth() >= today.getMonth()
        )
          return;
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar();
      });

      // Init: load data first, then render everything
      async function init() {
        await loadData();
        switchTab("posts"); // set initial active tab
        renderTagFilter();
        renderCalendar();
        renderPosts();
        renderDailyUpdates();
      }
      init();
    </script>
  </body>
</html>
